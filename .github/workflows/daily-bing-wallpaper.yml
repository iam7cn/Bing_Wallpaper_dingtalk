name: Daily Bing Wallpaper

# 配置定时运行（UTC时间，对应北京时间需要+8小时）
# 例如：UTC 16:00 = 北京时间 00:00（次日）
# UTC 08:00 = 北京时间 16:00
on:
  schedule:
    - cron: '0 8 * * *'  # 每天北京时间00:00运行
  workflow_dispatch:  # 手动触发开关

# 作业配置
jobs:
  run-script:
    runs-on: ubuntu-latest  # 使用Ubuntu系统运行

    steps:
      # 步骤1：检出仓库代码
      - name: Checkout code
        uses: actions/checkout@v4

      # 步骤2：设置Python环境
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'  # 指定Python版本

      # 步骤3：安装依赖
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests

      # 步骤4：运行Python脚本
      - name: Run Bing Wallpaper script
        env:
          DINGTALK_WEBHOOK: ${{ secrets.DINGTALK_WEBHOOK }}  # 从Secrets读取Webhook
        run: |
          python bing.py

      # 可选步骤：保存下载的壁纸（如果需要持久化）
      # 注意：GitHub Actions运行完成后，工作目录会被销毁，如需保存需提交到仓库
      - name: Save wallpaper files
        if: success()
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"
          git add Bing_Wallpaper/
          git commit -m "Update Bing wallpaper $(date +'%Y-%m-%d')" || echo "No new files to commit"
          git push
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}  # GitHub自动生成的Token，无需手动配置
